<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Schindler AI Assistant</title>
    <style>
        body {
            margin:0;
            font-family: Arial, sans-serif;
        }

        /* Floating AI Button */
        #ai-launcher {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: #4b5fff;
            border-radius: 50%;
            box-shadow: 0 4px 14px rgba(0,0,0,0.25);
            cursor: pointer;
            z-index: 9999;
            display:flex;
            justify-content:center;
            align-items:center;
            color:white;
            font-size: 26px;
            font-weight:bold;
        }

        /* Chat Window */
        #ai-chat-window {
            position: fixed;
            bottom: 96px;
            right: 24px;
            width: 360px;
            height: 480px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            display: none;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
        }

        /* Header */
        #ai-header {
            background: #4b5fff;
            padding: 14px;
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        /* Messages area */
        #ai-messages {
            flex:1;
            padding: 10px;
            overflow-y:auto;
            font-size: 14px;
        }

        .msg-user, .msg-ai {
            margin-bottom: 10px;
            max-width: 80%;
            padding: 8px 10px;
            border-radius: 8px;
            line-height: 1.3;
        }

        .msg-user {
            background:#e8ebff;
            margin-left:auto;
            text-align:right;
        }

        .msg-ai {
            background:#f4f6ff;
            margin-right:auto;
        }

        /* Input bar */
        #ai-input-bar {
            border-top:1px solid #ddd;
            padding:8px;
            display:flex;
        }

        #ai-input {
            flex:1;
            padding:8px;
            border-radius:6px;
            border:1px solid #ccc;
            font-size:14px;
        }

        #ai-send {
            margin-left:8px;
            background:#4b5fff;
            color:white;
            border:none;
            padding:8px 16px;
            border-radius:6px;
            cursor:pointer;
            font-size:14px;
        }
    </style>
</head>
<body>

<div id="ai-launcher">ðŸ’¬</div>

<div id="ai-chat-window">
    <div id="ai-header">Schindler AI Assistant</div>
    <div id="ai-messages"></div>
    <div id="ai-input-bar">
        <input id="ai-input" type="text" placeholder="Ask Schindler AI about this page..." />
        <button id="ai-send">Send</button>
    </div>
</div>

<script>
    // ðŸ”’ TODO: replace this with a NEW key, not the one you shared
    const GEMINI_API_KEY = "";

    const endpoint = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + GEMINI_API_KEY;

    const launcher = document.getElementById("ai-launcher");
    const chatWindow = document.getElementById("ai-chat-window");
    const messages = document.getElementById("ai-messages");
    const input = document.getElementById("ai-input");
    const sendBtn = document.getElementById("ai-send");

    launcher.onclick = () => {
        const show = chatWindow.style.display !== "flex";
        chatWindow.style.display = show ? "flex" : "none";
        chatWindow.style.flexDirection = "column";
    };

    sendBtn.onclick = sendMessage;
    input.addEventListener("keydown", e => {
        if (e.key === "Enter") sendMessage();
    });

    function addUserMessage(text) {
        const div = document.createElement("div");
        div.className = "msg-user";
        div.innerText = text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    }

    function addAIMessage(text) {
        const div = document.createElement("div");
        div.className = "msg-ai";
        div.innerHTML = text.replace(/\n/g, "<br>");
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage() {
        const text = input.value.trim();
        if (!text) return;

        addUserMessage(text);
        input.value = "";

        addAIMessage("<i>Thinkingâ€¦</i>");

        try {
            const pageContext = window.location.pathname;

            const prompt =
`You are Schindler AI, an assistant embedded inside a SharePoint page.
The current SharePoint section or path is: ${pageContext}.
Answer in simple English, maximum 3â€“4 sentences.
If the user asks about this site or this team, assume it is a Schindler internal site.

User question:
${text}`;

            const body = {
                contents: [
                    {
                        parts: [{ text: prompt }]
                    }
                ]
            };

            const res = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            const data = await res.json();
            const aiText =
                data.candidates?.[0]?.content?.parts?.[0]?.text ||
                "Sorry, I couldn't get a response from Schindler AI.";

            // replace the "Thinkingâ€¦" message
            messages.removeChild(messages.lastChild);
            addAIMessage(aiText);

        } catch (err) {
            messages.removeChild(messages.lastChild);
            addAIMessage("Error talking to Schindler AI: " + err.message);
        }
    }

    // Initial greeting
    addAIMessage("Hi, I'm <b>Schindler AI</b>. Ask me anything in natural language â€“ this is a demo assistant embedded in SharePoint.");
</script>

</body>
</html>
  
